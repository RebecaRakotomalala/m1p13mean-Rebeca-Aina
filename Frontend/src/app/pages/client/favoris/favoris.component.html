<!-- Breadcrumb -->
<div class="page-breadcrumb">
  <a routerLink="/" class="breadcrumb-link">Accueil</a>
  <span class="breadcrumb-sep">›</span>
  <span class="breadcrumb-current">Mes Favoris</span>
</div>

<!-- Header -->
<div class="page-header">
  <h1 class="page-title">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
    </svg>
    Mes Favoris
  </h1>
  <p class="page-subtitle">Retrouvez tous les produits et boutiques que vous aimez</p>
</div>

<!-- Stats -->
<div class="stats-row" *ngIf="!loading && favoris.length > 0">
  <div class="stat-card" (click)="filterType = ''" [class.active]="filterType === ''">
    <div class="stat-icon all">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    </div>
    <div>
      <div class="stat-value">{{ stats.total }}</div>
      <div class="stat-label">Total favoris</div>
    </div>
  </div>
  <div class="stat-card" (click)="filterType = 'produit'" [class.active]="filterType === 'produit'">
    <div class="stat-icon produits">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/>
      </svg>
    </div>
    <div>
      <div class="stat-value">{{ stats.produits }}</div>
      <div class="stat-label">Produits</div>
    </div>
  </div>
  <div class="stat-card" (click)="filterType = 'boutique'" [class.active]="filterType === 'boutique'">
    <div class="stat-icon boutiques">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
    </div>
    <div>
      <div class="stat-value">{{ stats.boutiques }}</div>
      <div class="stat-label">Boutiques</div>
    </div>
  </div>
</div>

<!-- Loading -->
<div *ngIf="loading" class="loading-container">
  <div class="spinner"></div>
  <p>Chargement de vos favoris...</p>
</div>

<!-- Empty State -->
<div *ngIf="!loading && favoris.length === 0" class="empty-state">
  <div class="empty-icon">
    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ddd" stroke-width="1">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
    </svg>
  </div>
  <h3>Aucun favori pour le moment</h3>
  <p>Explorez le catalogue et ajoutez des produits en favoris en cliquant sur le cœur ❤️</p>
  <button class="btn-primary-custom" (click)="goToCatalogue()">Explorer le catalogue</button>
</div>

<!-- No results for filter -->
<div *ngIf="!loading && favoris.length > 0 && favorisFiltres.length === 0" class="empty-state small">
  <h4>Aucun favori dans cette catégorie</h4>
  <button class="btn-outline-custom" (click)="filterType = ''">Voir tous les favoris</button>
</div>

<!-- Favorites Grid -->
<div class="favorites-grid" *ngIf="!loading && favorisFiltres.length > 0">

  <!-- Product Favorites -->
  <div *ngFor="let f of favorisFiltres; let i = index"
       class="fav-card"
       [class.removing]="isRemoving(f._id)"
       [style.animation-delay]="(i * 0.05) + 's'">

    <!-- PRODUIT -->
    <ng-container *ngIf="f.type === 'produit' && f.produit_id">
      <a [routerLink]="['/catalogue/produit', f.produit_id._id]" class="fav-link">
        <div class="fav-img-wrap">
          <img [src]="f.produit_id.image_principale || 'assets/images/authentication/img-placeholder.svg'"
               [alt]="f.produit_id.nom" class="fav-img" />
          <span class="fav-type-badge produit">Produit</span>
          <span class="fav-discount" *ngIf="getDiscount(f.produit_id) > 0">-{{ getDiscount(f.produit_id) }}%</span>
        </div>
        <div class="fav-body">
          <div class="fav-boutique" *ngIf="f.produit_id.boutique_id?.nom">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            {{ f.produit_id.boutique_id.nom }}
          </div>
          <h3 class="fav-name">{{ f.produit_id.nom }}</h3>
          <div class="fav-rating" *ngIf="f.produit_id.note_moyenne > 0">
            <span class="stars">
              <span *ngFor="let s of [1,2,3,4,5]" class="star" [class.filled]="s <= f.produit_id.note_moyenne">★</span>
            </span>
            <span class="rating-text">{{ f.produit_id.note_moyenne | number:'1.1-1' }}</span>
          </div>
          <div class="fav-pricing">
            <span class="fav-price">{{ (f.produit_id.prix_promo || f.produit_id.prix_initial) | number:'1.0-0' }} Ar</span>
            <span class="fav-old-price" *ngIf="f.produit_id.prix_promo && f.produit_id.prix_promo < f.produit_id.prix_initial">{{ f.produit_id.prix_initial | number:'1.0-0' }} Ar</span>
          </div>
        </div>
      </a>
      <div class="fav-actions">
        <button class="btn-cart" (click)="addToCart(f.produit_id._id)" title="Ajouter au panier">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          Ajouter au panier
        </button>
        <button class="btn-remove" (click)="removeFavori(f)" title="Retirer des favoris">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </button>
      </div>
    </ng-container>

    <!-- BOUTIQUE -->
    <ng-container *ngIf="f.type === 'boutique' && f.boutique_id">
      <a [routerLink]="['/boutiques', f.boutique_id._id]" class="fav-link">
        <div class="fav-img-wrap boutique-wrap">
          <div class="boutique-avatar">
            <span>{{ f.boutique_id.nom?.charAt(0)?.toUpperCase() }}</span>
          </div>
          <span class="fav-type-badge boutique">Boutique</span>
        </div>
        <div class="fav-body">
          <h3 class="fav-name">{{ f.boutique_id.nom }}</h3>
          <div class="fav-category" *ngIf="f.boutique_id.categorie_principale">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            {{ f.boutique_id.categorie_principale }}
          </div>
          <p class="fav-desc" *ngIf="f.boutique_id.description_courte">{{ f.boutique_id.description_courte | slice:0:80 }}...</p>
          <div class="fav-rating" *ngIf="f.boutique_id.note_moyenne > 0">
            <span class="stars">
              <span *ngFor="let s of [1,2,3,4,5]" class="star" [class.filled]="s <= f.boutique_id.note_moyenne">★</span>
            </span>
            <span class="rating-text">{{ f.boutique_id.note_moyenne | number:'1.1-1' }}</span>
            <span class="rating-count" *ngIf="f.boutique_id.nombre_avis">({{ f.boutique_id.nombre_avis }} avis)</span>
          </div>
        </div>
      </a>
      <div class="fav-actions">
        <a [routerLink]="['/boutiques', f.boutique_id._id]" class="btn-visit">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
          Visiter
        </a>
        <button class="btn-remove" (click)="removeFavori(f)" title="Retirer des favoris">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </button>
      </div>
    </ng-container>
  </div>
</div>

