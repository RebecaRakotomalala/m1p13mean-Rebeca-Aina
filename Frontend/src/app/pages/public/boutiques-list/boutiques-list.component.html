<!-- Hero Section -->
<section class="boutiques-hero">
  <div class="container">
    <div class="hero-content text-center">
      <h1 class="hero-title">Nos Boutiques</h1>
      <p class="hero-subtitle">DÃ©couvrez les meilleures boutiques de notre centre commercial en ligne</p>

      <!-- Search bar -->
      <div class="hero-search">
        <div class="search-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input
            type="text"
            class="search-input"
            placeholder="Rechercher une boutique, une catÃ©gorie..."
            [(ngModel)]="search"
            (input)="applyFilters()"
          />
          <button class="search-clear" *ngIf="search" (click)="search = ''; applyFilters()">âœ•</button>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="container boutiques-container">

  <!-- CatÃ©gories chips -->
  <div class="categories-section" *ngIf="categories.length > 0">
    <div class="categories-scroll">
      <button
        class="category-chip"
        [class.active]="selectedCategorie === ''"
        (click)="selectedCategorie = ''; applyFilters()"
      >
        ğŸª Toutes
      </button>
      <button
        *ngFor="let cat of categories"
        class="category-chip"
        [class.active]="selectedCategorie === cat"
        (click)="selectedCategorie = cat; applyFilters()"
      >
        {{ cat }}
      </button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="toolbar-left">
      <span class="results-count">
        <strong>{{ filteredBoutiques.length }}</strong> boutique{{ filteredBoutiques.length > 1 ? 's' : '' }}
        <span *ngIf="selectedCategorie"> dans Â« {{ selectedCategorie }} Â»</span>
      </span>
    </div>
    <div class="toolbar-right">
      <select class="sort-select" [(ngModel)]="sortBy" (change)="applyFilters()">
        <option value="nom">Tri : A â†’ Z</option>
        <option value="note">Tri : Meilleure note</option>
        <option value="recent">Tri : Plus rÃ©centes</option>
      </select>
      <div class="view-toggle">
        <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'" title="Grille">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
        </button>
        <button class="view-btn" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'" title="Liste">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="4" rx="1.5"/><rect x="3" y="10" width="18" height="4" rx="1.5"/><rect x="3" y="16" width="18" height="4" rx="1.5"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="loading">
    <div class="loading-grid">
      <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5,6]">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-line w-60"></div>
        <div class="skeleton-line w-40"></div>
        <div class="skeleton-line w-80"></div>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!loading && filteredBoutiques.length === 0">
    <div class="empty-illustration">ğŸ”</div>
    <h3>Aucune boutique trouvÃ©e</h3>
    <p>Essayez avec d'autres termes de recherche ou changez de catÃ©gorie.</p>
    <button class="btn-reset" (click)="clearFilters()">RÃ©initialiser les filtres</button>
  </div>

  <!-- Grid View -->
  <div class="boutiques-grid" *ngIf="!loading && viewMode === 'grid' && filteredBoutiques.length > 0">
    <div class="boutique-card" *ngFor="let b of filteredBoutiques; let i = index" [routerLink]="['/boutiques', b._id]" [style.animation-delay]="(i * 0.05) + 's'">
      <!-- Banner -->
      <div class="card-banner" [style.background]="b.banniere_url ? 'url(' + b.banniere_url + ') center/cover' : getAvatarGradient(b.nom)">
        <div class="card-banner-overlay"></div>
        <span class="card-badge" *ngIf="b.note_moyenne >= 4">â­ Top</span>
      </div>

      <!-- Avatar -->
      <div class="card-avatar-wrap">
        <div class="card-avatar" *ngIf="!b.logo_url" [style.background]="getAvatarGradient(b.nom)">
          {{ getInitials(b.nom) }}
        </div>
        <img class="card-avatar card-avatar-img" *ngIf="b.logo_url" [src]="b.logo_url" [alt]="b.nom" />
      </div>

      <!-- Content -->
      <div class="card-content">
        <h3 class="card-name">{{ b.nom }}</h3>
        <span class="card-category">{{ b.categorie_principale }}</span>

        <p class="card-description" *ngIf="b.description_courte">
          {{ b.description_courte | slice:0:100 }}{{ b.description_courte && b.description_courte.length > 100 ? '...' : '' }}
        </p>

        <!-- Rating -->
        <div class="card-rating">
          <div class="stars">
            <span *ngFor="let s of getStars(b.note_moyenne)" class="star" [class.filled]="s === 1">â˜…</span>
          </div>
          <span class="rating-text" *ngIf="b.note_moyenne > 0">
            {{ b.note_moyenne | number:'1.1-1' }}
          </span>
          <span class="reviews-count" *ngIf="b.nombre_avis > 0">
            ({{ b.nombre_avis }} avis)
          </span>
          <span class="no-rating" *ngIf="!b.note_moyenne || b.note_moyenne === 0">
            Pas encore notÃ©
          </span>
        </div>

        <!-- Footer -->
        <div class="card-footer-info">
          <span class="card-views" *ngIf="b.nombre_vues > 0">
            ğŸ‘ {{ b.nombre_vues }} vues
          </span>
          <span class="card-cta">Visiter â†’</span>
        </div>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="boutiques-list" *ngIf="!loading && viewMode === 'list' && filteredBoutiques.length > 0">
    <div class="boutique-list-item" *ngFor="let b of filteredBoutiques; let i = index" [routerLink]="['/boutiques', b._id]" [style.animation-delay]="(i * 0.04) + 's'">
      <!-- Avatar -->
      <div class="list-avatar" *ngIf="!b.logo_url" [style.background]="getAvatarGradient(b.nom)">
        {{ getInitials(b.nom) }}
      </div>
      <img class="list-avatar list-avatar-img" *ngIf="b.logo_url" [src]="b.logo_url" [alt]="b.nom" />

      <!-- Info -->
      <div class="list-info">
        <div class="list-header">
          <h3 class="list-name">{{ b.nom }}</h3>
          <span class="list-category">{{ b.categorie_principale }}</span>
        </div>
        <p class="list-description" *ngIf="b.description_courte">
          {{ b.description_courte | slice:0:150 }}{{ b.description_courte && b.description_courte.length > 150 ? '...' : '' }}
        </p>
        <div class="list-meta">
          <div class="stars-sm">
            <span *ngFor="let s of getStars(b.note_moyenne)" class="star" [class.filled]="s === 1">â˜…</span>
            <span class="rating-text" *ngIf="b.note_moyenne > 0">{{ b.note_moyenne | number:'1.1-1' }}</span>
          </div>
          <span class="list-avis" *ngIf="b.nombre_avis">{{ b.nombre_avis }} avis</span>
          <span class="list-views" *ngIf="b.nombre_vues > 0">ğŸ‘ {{ b.nombre_vues }}</span>
        </div>
      </div>

      <!-- CTA -->
      <div class="list-cta">
        <span class="btn-visit">Visiter</span>
      </div>
    </div>
  </div>

</div>

